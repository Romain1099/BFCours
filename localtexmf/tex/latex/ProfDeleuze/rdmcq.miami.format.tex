%%%%%%%%%%%%%%% Miami


\definecolor{miami1}{HTML}{2d254f}
\definecolor{miami2}{HTML}{6158ac}
\definecolor{miami3}{HTML}{a49bc6}
\definecolor{miami4}{HTML}{DC8E44}% Lettre n° question
\definecolor{miami5}{HTML}{008001}% vert
\definecolor{miami6}{HTML}{A9450A}%    bas br
\definecolor{miami7}{HTML}{CF6D0A}% milieu br
\definecolor{miami8}{HTML}{FF8F00}% orange foncé
\definecolor{miami9}{HTML}{FFBE00}% orange clair

\begin{tikzfadingfrompicture}[name=miamibr]
  % must be 2cm*2cm in size
  \clip (0,0) rectangle (2,2);
  \shade [left color=transparent!0, right color=transparent!100] (0,0) rectangle (0.4,2);
  \shade [left color=transparent!100, right color=transparent!100] (0.4,0) rectangle (0.6,2);
  \shade [left color=transparent!100, right color=transparent!0]  (0.6,0) rectangle (2,2);
\end{tikzfadingfrompicture}



\begin{tikzfadingfrompicture}[name=miamifading]
  % must be 2cm*2cm in size
  \clip (0,0) rectangle (2,2);
  \shade [left color=transparent, right color=transparent!0] (0,2) rectangle (0.4,1);
  \shade [left color=transparent!0, right color=transparent!0] (0.4,2) rectangle (0.9,1);
  \shade [left color=transparent!0, right color=transparent]  (0.9,2) rectangle (2,1);
  %
  \shade [left color=transparent, right color=transparent]  (0,0) rectangle (1,1);
  \shade [left color=transparent, right color=transparent!0] (1,0) rectangle (1.7,1);
  \shade [left color=transparent!0, right color=transparent!0] (1.7,0) rectangle (2,1);
\end{tikzfadingfrompicture}

\pgfdeclareverticalshading[miamishadingcolor]{miamishading}{100bp}{%   haut=100bp
color(0bp)=(pgftransparent!0);
color(25bp)=(pgftransparent!0);
color(35bp)=(miamishadingcolor);
color(65bp)=(miamishadingcolor);
color(75bp)=(pgftransparent!0);
color(100bp)=(pgftransparent!0)
}%




\tikzoption{miami shading}{\pgfutil@colorlet{miamishadingcolor}{#1}\def\tikz@shading{miamishading}\tikz@addmode{\tikz@mode@shadetrue}}



\tcbset{miami shape/.style={%
        frame code={%
                \shade[top color=#1, bottom color=#1!70] ([xshift=0.9cm]frame.south west) .. controls +(-0.35,0) and +(0.35,0) .. (frame.west)
                    .. controls +(0.35,0) and +(-0.35,0) .. ([xshift=0.9cm]frame.north west)
                    .. controls +(0.35,0) and +(-.35,0) .. ([xshift=-0.9cm]frame.north east)
                    .. controls +(0.35,0) and +(-0.35,0) .. (frame.east)
                     .. controls +(-0.35,0) and +(0.35,0) .. ([xshift=-0.9cm]frame.south east)
                     --cycle
                ;
            },
        interior code={%
            \shade[miami shading=#1,  path fading=miamifading, opacity=0.9, preaction={fill=#1}]
                    ([xshift=0.9cm]interior.south west) .. controls +(-0.35,0) and +(0.35,0) .. (interior.west)
                    .. controls +(0.35,0) and +(-0.35,0) .. ([xshift=0.9cm]interior.north west)
                    .. controls +(0.35,0) and +(-.35,0) .. ([xshift=-0.9cm]interior.north east)
                    .. controls +(0.35,0) and +(-0.35,0) .. (interior.east)
                     .. controls +(-0.35,0) and +(0.35,0) .. ([xshift=-0.9cm]interior.south east)
                     --cycle
                ;
            },
    }
}

\newQuestionFormat{Miami}{% boîte externe
opacityback=1,
miami shape=miami1
}%
{%    boîte interne
    boxsep=3pt,
    left=0.9cm, right=0.9cm, top=1pt,
    fontupper=\sffamily,
    coltext=white, halign=center,
}

\newMessageFormat{Miami}{%
    boxsep=3pt,
    left=0.9cm, right=0.9cm, top=1pt,
    fontupper=\sffamily,
    coltext=white, halign=center,
    miami shape=miami5
}



\newAnswerFormat{Miami}{vertical}
        {%  Zone Réponse
        }%
        [%  Mode correction
        interior code={
                \shade[top color=miami8!80!black, bottom color=miami8, middle color=miami8!80, path fading=miamibr, preaction={fill=miami9}] ([xshift=0.9cm]interior.south west) .. controls +(-0.35,0) and +(0.35,0) .. ([xshift=2pt]interior.west)
                    .. controls +(0.35,0) and +(-0.35,0) .. ([xshift=0.9cm]interior.north west)
                    .. controls +(0.35,0) and +(-.35,0) .. ([xshift=-0.9cm]interior.north east)
                    .. controls +(0.35,0) and +(-0.35,0) .. ([xshift=-2pt]interior.east)
                     .. controls +(-0.35,0) and +(0.35,0) .. ([xshift=-0.9cm]interior.south east)
                     --cycle
                ;
            },
        ]%
        {%  Boîtes internes
            left=0.6cm, right=0.6cm, boxsep=3pt, top=1pt, rdmcq frame,
            fontupper=\sffamily,
            coltext=\ifmcqbr{black}{white}, halign=left,
            before upper=\ifmcqbr{\textcolor{black}}{\textcolor{miami4}}{\bfseries\char\numexpr64+\rdmcqAnswercount\relax : },
            miami shape=miami1,
            finish={%
                \fill[white] ([xshift=0.55cm]interior.west)--++(-2pt,1.25pt)--++(-2pt,-1.25pt)--++(2pt,-1.25pt)--cycle;
            }
        }

\newAnswerFormat{Miami}{horizontal}
        {%  Zone Réponse
        }%
        [%  Mode correction
        interior code={
                \shade[top color=miami8!80!black, bottom color=miami8, middle color=miami8!80, path fading=miamibr, preaction={fill=miami9}] ([xshift=0.9cm]interior.south west) .. controls +(-0.35,0) and +(0.35,0) .. ([xshift=2pt]interior.west)
                    .. controls +(0.35,0) and +(-0.35,0) .. ([xshift=0.9cm]interior.north west)
                    .. controls +(0.35,0) and +(-.35,0) .. ([xshift=-0.9cm]interior.north east)
                    .. controls +(0.35,0) and +(-0.35,0) .. ([xshift=-2pt]interior.east)
                     .. controls +(-0.35,0) and +(0.35,0) .. ([xshift=-0.9cm]interior.south east)
                     --cycle
                ;
            },
        ]%
        {%  Boîtes internes
            left=0.6cm, right=0.6cm, boxsep=3pt, top=1pt, rdmcq frame,
            fontupper=\sffamily,
            coltext=\ifmcqbr{black}{white}, halign=left, valign=center,
            before upper=\ifmcqbr{\textcolor{black}}{\textcolor{miami4}}{\bfseries\char\numexpr64+\rdmcqAnswercount\relax : },
            miami shape=miami1,
            finish={%
                \fill[white] ([xshift=0.55cm]interior.west)--++(-2pt,1.25pt)--++(-2pt,-1.25pt)--++(2pt,-1.25pt)--cycle;
            }
        }

\newcommand{\miamidiamond}[1][.]{%
\tikz[baseline=-0.6ex] \fill[fill=#1] (0,0)--++(0.5em,0.3125em)--++(0.5em,-0.3125em)--++(-0.5em,-0.3125em)--cycle;%
}

\newHeaderFormatFrom{default}{Miami}%
\appendHeaderFormat{Miami}{%
    fontupper=\sffamily\bfseries\large,
    coltext=miami1,
    before upper=\miamidiamond\hspace*{1em},
    after upper=\hspace*{1em}\miamidiamond,
}

\newFooterFormat{Miami}%
    {%  Left footer
    blankest,
    boxsep=5pt,
    halign=center, valign=center,
    fontupper=\sffamily\bfseries\footnotesize,
    coltext=miami1,
    }

\newMcqFormat[gather=Miami, row sep=0.5em, answer columns=2, answer row sep=0.5em, same width, orientation=vertical]{Miami}{1pt}