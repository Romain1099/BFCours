\ProvidesPackage{bfcours-EnteteExplications}[2024/06/29 v1.0 Commandes pour les explcations flechées pour bfcours]

\usetikzlibrary{tikzmark, arrows.meta, positioning, calc, shadows}
\newcounter{expliquerCounter}
\setcounter{expliquerCounter}{0}
\newcounter{prof}
\setcounter{prof}{0} % Initialise la variable prof à 0

\newcommand{\masquer}[1]{%
  \ifnum\value{prof}=1%
    #1%
  \else%
    \phantom{\large{#1}}%
  \fi%
}

% Définition de la nouvelle commande
\newcommand{\montre}[6]{%
 \hspace{-0.5cm}\smash{
\raisebox{-3pt}{
  \begin{tcolorbox}[%
    nobeforeafter,
    %before skip=-10pt, % Réduit l'espace avant la boîte
    %after skip=-10pt,  % Réduit l'espace après la boîte
    colback=white,
    colframe=purple,
    rounded corners,
    hbox,
    drop shadow,
    boxrule=0.5pt,
    left=-0.5pt,  % Espacement latéral gauche
    right=-0.5pt, % Espacement latéral droit
    top=0pt,   % Espacement vertical du haut
    bottom=0pt,% Espacement vertical du bas
    enhanced,
    overlay unbroken and first={%
      \begin{scope}[shift={(frame.#3)}]
        \coordinate (A) at (0,0);
        \coordinate (B) at (#4,#5);
        \node[draw=purple, fill=purple!20, rounded corners, drop shadow, anchor=north west] (target) at (B) {#2};
         \draw[-{Stealth[scale=1]}, purple] (A) to[out=#6, in=-#6] (target.#3); % Flèche arrive au bord le plus proche
      \end{scope}
    }
  ]
  \centering #1
  \end{tcolorbox}  
}
}\hspace{-0.7cm}
}
\newcommand{\montreNS}[6]{%
 \hspace{-0.5cm}\smash{
\raisebox{-3pt}{
  \begin{tcolorbox}[%
    nobeforeafter,
    %before skip=-10pt, % Réduit l'espace avant la boîte
    %after skip=-10pt,  % Réduit l'espace après la boîte
    colback=white,
    colframe=purple,
    rounded corners,
    hbox,
    drop shadow,
    boxrule=0pt,
    left=-0.5pt,  % Espacement latéral gauche
    right=-0.5pt, % Espacement latéral droit
    top=-0.5pt,   % Espacement vertical du haut
    bottom=-0.5pt,% Espacement vertical du bas
    enhanced,
    overlay unbroken and first={%
      \begin{scope}[shift={(frame.#3)}]
        \coordinate (A) at (0,0);
        \coordinate (B) at (#4,#5);
        \node[draw=purple, fill=purple!20, rounded corners, drop shadow, anchor=north west] (target) at (B) {#2};
         \draw[-{Stealth[scale=1]}, purple] (A) to[out=#6, in=180] (target.west); % Flèche arrive au bord le plus proche
      \end{scope}
    }
  ]
  \centering #1
  \end{tcolorbox}  
}
}\hspace{-0.7cm}
}
\newcounter{flecheSENScounter}
\stepcounter{flecheSENScounter}

\newcommand{\montreSimple}[7]{%
  #2\tikzmark{start#1} % Texte de départ et marqueur de position
  \begin{tikzpicture}[remember picture, overlay]
    \coordinate (A) at (pic cs:start#1); % Position de départ récupérée grâce au tikzmark
    \coordinate (B) at ([xshift=#5, yshift=#6]A); % Position de la boîte cible définie par les décalages #5 et #6
    \node[draw=purple, fill=purple!20, rounded corners, drop shadow, anchor=north west] (target#1) at (B) {#3};
    %\draw[-{Stealth[scale=1.3]}, purple, line width=1.5pt] (A) to[out=#7, in=180-#7] (target#1); % Angle de la flèche défini par #7   .#4marqué après le target  ------------pour un style courbe bezier
    %\draw[-{Stealth[scale=1.3]}, purple, line width=1.5pt, bend right=(-20)] (A) to (target#1); % Angle de la flèche défini par #7   .#4marqué après le target %pour un style bendé
	\draw[-{Stealth[scale=1.3]}, purple, line width=1.5pt] (A) to (target#1); % Angle de la flèche défini par #7   .#4marqué après le target %pour un style bendé
  \end{tikzpicture}
}
% Définition de la nouvelle commande
\newcommand{\montreSeyes}[7]{%
 \smash{%
\raisebox{-3pt}{%
  \begin{tcolorbox}[%
    nobeforeafter,
    %before skip=-10pt, % Réduit l'espace avant la boîte
    %after skip=-10pt,  % Réduit l'espace après la boîte
    colback=white,
    colframe=purple,
    rounded corners,
    hbox,
    drop shadow,
    boxrule=0.5pt,
    left=-0.5pt,  % Espacement latéral gauche
    right=-0.5pt, % Espacement latéral droit
    top=-15pt,   % Espacement vertical du haut
    bottom=10pt,% Espacement vertical du bas
    enhanced,
    overlay unbroken and first={%
      \begin{scope}[shift={(frame.#3)}]
        \coordinate (A) at (0,0);
        \coordinate (B) at (#4,#5);
        \node[draw=purple, fill=purple!20, rounded corners, drop shadow, anchor=north west] (target) at (B) {#2};
         \draw[-{Stealth[scale=1]}, purple] (A) to[out=#6, in=180] (target.west); % Flèche arrive au bord le plus proche
      \end{scope}
    }
  ]
  \seyesCMD{1}{5}{1.9mm}{\textwidth}{-0.05cm}{#1}\huge{\phantom{#1}}
  \end{tcolorbox}
}
}\hspace{-0.7cm}
}
% Définition de la nouvelle commande
\newcommand{\expliqueSeyes}[1]{%
 \smash{%
\raisebox{-3pt}{%
  \begin{tcolorbox}[%
    %nobeforeafter,
    before skip=2pt, % Réduit l'espace avant la boîte
    after skip=2pt,  % Réduit l'espace après la boîte
    colback=white,
    colframe=purple,
    rounded corners,
    hbox,
    drop shadow,
    boxrule=0.5pt,
    left=-0.5pt,  % Espacement latéral gauche
    right=-0.5pt, % Espacement latéral droit
    top=-15pt,   % Espacement vertical du haut
    bottom=10pt,% Espacement vertical du bas
    enhanced,
  ]
  \seyesCMD{1}{5}{1.9mm}{\textwidth}{-0.05cm}{#1}\huge{\phantom{#1}}
  \end{tcolorbox}
}
}\hspace{-0.7cm}
}
% Définition de la nouvelle commande
\newcommand{\expliqueSeyesFrac}[1]{%
% \smash{%
\raisebox{-12pt}{%
  \begin{tcolorbox}[%
    %nobeforeafter,
    before skip=2pt, % Réduit l'espace avant la boîte
    after skip=2pt,  % Réduit l'espace après la boîte
    colback=white,
    colframe=purple,
    rounded corners,
    hbox,
    drop shadow,
    boxrule=0.5pt,
    left=-0.5pt,  % Espacement latéral gauche
    right=-0.5pt, % Espacement latéral droit
    top=-11pt,   % Espacement vertical du haut
    bottom=10pt,% Espacement vertical du bas
    enhanced,
  ]
  \seyesFrac{1.5}{6.5}{1.9mm}{\textwidth}{-0.05cm}{#1}\Large{\phantom{#1}}  % param 3 a 1.9mm origine
  \end{tcolorbox}
}
%}\hspace{-0.7cm}
}
\newcommand{\expliquer}[2]{%
    \stepcounter{expliquerCounter}%
    \begin{tikzpicture}[remember picture, baseline]
        \ifcase\theexpliquerCounter\relax
        \or % 1: haut gauche (rouge)
            \node[draw=red, inner sep=3pt, anchor=base] (a\theexpliquerCounter) {#1};
        \or % 2: bas gauche (bleu)
            \node[draw=blue, inner sep=3pt, anchor=base] (a\theexpliquerCounter) {#1};
        \or % 3: haut milieu (vert)
            \node[draw=green, inner sep=3pt, anchor=base] (a\theexpliquerCounter) {#1};
        \or % 4: bas milieu (orange)
            \node[draw=orange, inner sep=3pt, anchor=base] (a\theexpliquerCounter) {#1};
        \or % 5: haut droite (violet)
            \node[draw=purple, inner sep=3pt, anchor=base] (a\theexpliquerCounter) {#1};
        \or % 6: bas droite (marron)
            \node[draw=brown, inner sep=3pt, anchor=base] (a\theexpliquerCounter) {#1};
        \fi
    \end{tikzpicture}%
    \begin{tikzpicture}[remember picture, overlay]
        \ifcase\theexpliquerCounter\relax
        \or % 1: haut gauche (rouge)
            \node[above left=of a\theexpliquerCounter, node distance=1.5cm, draw=red, fill=red!10, align=center, drop shadow] (b\theexpliquerCounter) {\masquer{#2}};
            \draw[-Stealth, red] (a\theexpliquerCounter.north west) -- (b\theexpliquerCounter.south east);
        \or % 2: bas gauche (bleu)
            \node[below left=of a\theexpliquerCounter, node distance=1.5cm, draw=blue, fill=blue!10, align=center, drop shadow] (b\theexpliquerCounter) {\masquer{#2}};
            \draw[-Stealth, blue] (a\theexpliquerCounter.south west) -- (b\theexpliquerCounter.north east);
        \or % 3: haut milieu (vert)
            \node[above=of a\theexpliquerCounter, node distance=1.5cm, draw=green, fill=green!10, align=center, drop shadow] (b\theexpliquerCounter) {\masquer{#2}};
            \draw[-Stealth, green] (a\theexpliquerCounter.north) -- (b\theexpliquerCounter.south);
        \or % 4: bas milieu (orange)
            \node[below=of a\theexpliquerCounter, node distance=1.5cm, draw=orange, fill=orange!10, align=center, drop shadow] (b\theexpliquerCounter) {\masquer{#2}};
            \draw[-Stealth, orange] (a\theexpliquerCounter.south) -- (b\theexpliquerCounter.north);
        \or % 5: haut droite (violet)
            \node[above right=of a\theexpliquerCounter, node distance=1.5cm, draw=purple, fill=purple!10, align=center, drop shadow] (b\theexpliquerCounter) {\masquer{#2}};
            \draw[-Stealth, purple] (a\theexpliquerCounter.north east) -- (b\theexpliquerCounter.south west);
        \or % 6: bas droite (marron)
            \node[below right=of a\theexpliquerCounter, node distance=1.5cm, draw=brown, fill=brown!10, align=center, drop shadow] (b\theexpliquerCounter) {\masquer{#2}};
            \draw[-Stealth, brown] (a\theexpliquerCounter.south east) -- (b\theexpliquerCounter.north west);
        \fi
    \end{tikzpicture}%
}
\newtcolorbox{DetaillerBox}[1]{
  colback=black!5, % Couleur de fond de la boîte (noir atténué à 5)
  colframe=black, % Couleur du cadre (noir)
  coltitle=white, % Couleur du titre (blanc)
  colbacktitle=black, % Couleur de fond du titre (noir)
  fonttitle=\bfseries\large, % Style du titre
  title=\textbf{\large{#1}}, % Titre
  halign title=center, % Alignement horizontal du titre
  attach boxed title to top center={yshift=-\tcboxedtitleheight/2}, % Position du titre
  enhanced,
  rounded corners % Coins arrondis
}
\newtcolorbox{DetaillerBoxB}[1]{
  colback=black!5, % Couleur de fond de la boîte (noir atténué à 5)
  colframe=black, % Couleur du cadre (noir)
  coltitle=white, % Couleur du titre (blanc)
  colbacktitle=black, % Couleur de fond du titre (noir)
  fonttitle=\bfseries\large, % Style du titre
  title=\textbf{\large{#1}}, % Titre
  halign title=left, % Alignement horizontal du titre
  attach boxed title to top left,%={yshift=-\tcboxedtitleheight/2}, % Position du titre
  enhanced,
  rounded corners % Coins arrondis
}
\newtcolorbox{DetaillerBoxC}[1]{
  colback=black!5, % Couleur de fond de la boîte (noir atténué à 5)
  colframe=black, % Couleur du cadre (noir)
  coltitle=white, % Couleur du titre (blanc)
  colbacktitle=black, % Couleur de fond du titre (noir)
  fonttitle=\bfseries\large, % Style du titre
  title=\textbf{\large{#1}}, % Titre
  halign title=left, % Alignement horizontal du titre
  attach boxed title to top left={yshift=-\tcboxedtitleheight}, % Position du titre
  enhanced,
  rounded corners % Coins arrondis
}
\newtcolorbox{DetaillerBoxD}[2]{
  colback=white,%black!5, % Couleur de fond de la boîte (noir atténué à 5)
  colframe=black, % Couleur du cadre (noir)
  coltitle=white, % Couleur du titre (blanc)
%  hbox,
  width = #1,
  colbacktitle=black!80, % Couleur de fond du titre (noir)
  fonttitle=\bfseries\large, % Style du titre
  title=\textbf{\large{#2}}, % Titre
  halign title=left, % Alignement horizontal du titre
  attach boxed title to top left={yshift=-\tcboxedtitleheight/2}, % Position du titre
  enhanced,
  sharp corners % Coins droits
}
\newcommand{\calcul}[2][\textwidth]{% Fait apparaitre une box pour expliquer un point quelconque.
\begin{DetaillerBoxD}{#1}{Calcul}
\vspace*{0.25cm} 
#2
\end{DetaillerBoxD}
}
\newcommand{\detailler}[2]{% Fait apparaitre une box pour expliquer un point quelconque.
\begin{DetaillerBox}{#1}
#2
\end{DetaillerBox}
}

\newcommand{\bazarder}[2]{% Fait apparaitre une box pour expliquer un point quelconque.
\begin{DetaillerBoxC}{#1}
\vspace*{0.5cm} #2
\end{DetaillerBoxC}
}
\newcommand{\resetExpliquer}{\setcounter{expliquerCounter}{0}}
\def\couleur{black}
\newcommand{\explication}[3]{\begin{center}
   \begin{tcolorbox}[
    enhanced,
    breakable,  % permet à la boîte de s'étendre sur plusieurs pages
    drop shadow,
    attach boxed title to top center={yshift=-3mm,yshifttext=-1mm},
    colbacktitle=\couleur!85!black,
    title=\large{\textbf{#1}},
    coltitle=white,
    colback=white,
    colframe=\couleur!75!black,
    boxsep=0pt,
    width=#3\columnwidth,
    boxed title style={drop shadow}
]
    \vspace*{2cm}
    \resetExpliquer
    #2
    \vspace*{2cm}
\end{tcolorbox}
\end{center}
}
\newcommand{\envaleur}[1]{
    \expliqueSeyes{\phantom{|}#1}
}
\newcommand{\trouver}[1]{
	\expliqueSeyes{\phantom{|}\masquerSiProf{#1}}
}
\newcommand{\Vfrac}[2]{%
  \expliqueSeyesFrac{$\dfrac{\phantom{a}#1\phantom{a}}{\phantom{a}#2\phantom{a}}$}
}
\newcommand{\VfracTrouve}[2]{%
  \expliqueSeyesFrac{$\dfrac{\phantom{a}\masquerSiProf{#1}\phantom{a}}{\phantom{a}\masquerSiProf{#2}\phantom{a}}$}
}
\newcommand{\VfracTrouveW}[4]{%
  \raisebox{4pt}{\expliqueSeyesFrac{\hspace{#3 cm}\vspace{#4 cm}\raisebox{1pt}{$\dfrac{\phantom{a}\masquerSiProf{#1}\phantom{a}}{\phantom{a}\masquerSiProf{#2}\phantom{a}}$}}}
}

\endinput